@if (budgetData(); as data) {
<os-card [variant]="variant() === 'compact' ? 'flat' : 'default'" [size]="size()" [clickable]="clickable()"
    (click)="onCardClick()" [class]="cardClasses()" [attr.aria-label]="effectiveAriaLabel()"
    [attr.aria-describedby]="ariaDescribedBy() || null" role="region">
    <!-- Header -->
    <div class="os-budget-summary__header">
        <div class="os-budget-summary__title-section">
            <h3 class="os-budget-summary__title">{{ data.name }}</h3>
            @if (data.category) {
            <span class="os-budget-summary__category">{{ data.category }}</span>
            }
        </div>

        @if (showStatus()) {
        <os-badge [variant]="statusInfo().type" [size]="size() === 'large' ? 'md' : 'sm'">
            <os-icon [name]="statusInfo().icon" [size]="size() === 'large' ? 'md' : 'sm'"></os-icon>
            {{ statusInfo().label }}
        </os-badge>
        }
    </div>

    <!-- Progress Section -->
    @if (showProgress()) {
    <div class="os-budget-summary__progress">
        <div class="os-budget-summary__progress-header">
            <span class="os-budget-summary__progress-label">Progresso</span>
            <span class="os-budget-summary__progress-percentage">{{ progressPercentage() }}%</span>
        </div>

        <div class="os-budget-summary__progress-bar">
            <div class="os-budget-summary__progress-fill" [style.width.%]="progressPercentage()"
                [class.os-budget-summary__progress-fill--over-budget]="isOverBudget()"
                [class.os-budget-summary__progress-fill--completed]="isCompleted()"></div>
        </div>
    </div>
    }

    <!-- Financial Summary -->
    <div class="os-budget-summary__financial">
        <div class="os-budget-summary__amount-group">
            <div class="os-budget-summary__amount" [class]="getTotalHighlightClass()">
                <span class="os-budget-summary__amount-label">Orçamento Total</span>
                <os-money-display [value]="data.totalBudget" [variant]="'default'" [size]="size()"
                    [class]="highlightTotals() ? 'os-budget-summary__total--highlighted' : ''"></os-money-display>
            </div>

            <div class="os-budget-summary__amount">
                <span class="os-budget-summary__amount-label">Gasto</span>
                <os-money-display [value]="data.spentAmount" [variant]="isOverBudget() ? 'error' : 'default'"
                    [size]="size()"></os-money-display>
            </div>

            <div class="os-budget-summary__amount">
                <span class="os-budget-summary__amount-label">Restante</span>
                <os-money-display [value]="data.remainingAmount"
                    [variant]="data.remainingAmount >= 0 ? 'success' : 'error'" [size]="size()"></os-money-display>
            </div>
        </div>
    </div>

    <!-- Chart Section -->
    @if (showChart() && chartData(); as chart) {
    <div class="os-budget-summary__chart" [attr.aria-label]="'Gráfico de distribuição do orçamento'">
        <div class="os-budget-summary__chart-header">
            <span class="os-budget-summary__chart-title">Distribuição</span>
            <button class="os-budget-summary__chart-toggle" (click)="onChartClick(getChartType())"
                [attr.aria-label]="'Alternar tipo de gráfico'">
                <os-icon [name]="getChartType() === 'pie' ? 'bar_chart' : 'pie_chart'" size="sm"></os-icon>
            </button>
        </div>

        @if (getChartType() === 'pie') {
        <div class="os-budget-summary__pie-chart">
            <div class="os-budget-summary__pie-slice" [style.background]="chart.spent.color"
                [style.transform]="'rotate(0deg) scale(' + (chart.spent.percentage / 100) + ')'"
                [attr.aria-label]="'Gasto: ' + chart.spent.value + ' reais'">
            </div>
            <div class="os-budget-summary__pie-slice" [style.background]="chart.remaining.color"
                [style.transform]="'rotate(' + (chart.spent.percentage * 3.6) + 'deg) scale(' + (chart.remaining.percentage / 100) + ')'"
                [attr.aria-label]="'Restante: ' + chart.remaining.value + ' reais'">
            </div>
        </div>
        } @else {
        <div class="os-budget-summary__bar-chart">
            <div class="os-budget-summary__bar-group">
                <div class="os-budget-summary__bar" [style.height.%]="chart.spent.percentage"
                    [style.background]="chart.spent.color" [attr.aria-label]="'Gasto: ' + chart.spent.value + ' reais'">
                </div>
                <div class="os-budget-summary__bar" [style.height.%]="chart.remaining.percentage"
                    [style.background]="chart.remaining.color"
                    [attr.aria-label]="'Restante: ' + chart.remaining.value + ' reais'">
                </div>
            </div>
        </div>
        }
    </div>
    }

    <!-- Dates Section (only for detailed variant) -->
    @if (variant() === 'detailed' && showDates() && formattedDates(); as dates) {
    <div class="os-budget-summary__dates">
        <div class="os-budget-summary__date-item">
            <os-icon name="calendar_today" size="sm"></os-icon>
            <span class="os-budget-summary__date-label">Início:</span>
            <span class="os-budget-summary__date-value">{{ dates.start }}</span>
        </div>

        <div class="os-budget-summary__date-item">
            <os-icon name="event" size="sm"></os-icon>
            <span class="os-budget-summary__date-label">Fim:</span>
            <span class="os-budget-summary__date-value">{{ dates.end }}</span>
        </div>

        <div class="os-budget-summary__date-item">
            <os-icon name="update" size="sm"></os-icon>
            <span class="os-budget-summary__date-label">Atualizado:</span>
            <span class="os-budget-summary__date-value">{{ dates.lastUpdated }}</span>
        </div>
    </div>
    }

    <!-- Compact variant additional info -->
    @if (variant() === 'compact') {
    <div class="os-budget-summary__compact-info">
        <span class="os-budget-summary__compact-percentage">{{ progressPercentage() }}%</span>
        <span class="os-budget-summary__compact-status" [style.color]="getStatusColor()">
            {{ statusInfo().label }}
        </span>
    </div>
    }

    <!-- Loading State -->
    @if (loading()) {
    <div class="os-budget-summary__loading" aria-live="polite" aria-label="Carregando dados do orçamento">
        <div class="os-budget-summary__skeleton">
            <div class="os-budget-summary__skeleton-header"></div>
            <div class="os-budget-summary__skeleton-progress"></div>
            <div class="os-budget-summary__skeleton-amounts">
                <div class="os-budget-summary__skeleton-amount"></div>
                <div class="os-budget-summary__skeleton-amount"></div>
                <div class="os-budget-summary__skeleton-amount"></div>
            </div>
        </div>
    </div>
    }
</os-card>
}